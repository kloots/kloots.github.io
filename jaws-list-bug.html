<!doctype html>

<style type="text/css">
	.selected {
		background-color: lightblue; 
	}
</style>

<div role="application">

	<div id="resultslist" role="list" tabindex="0" aria-label="Channel General">
		<div role="listitem" tabindex="-1" aria-label="Todd Kloots at 12:25 PM this is a test message">
			<div role="document">
				<a href="/message"><strong>Todd</strong> @kloots</a>
				<p>Lorem ipsum dolor sit amet, suas veri eos id. Mel ex choro exerci. Id nam natum postulant. Alii tritani detracto ut eam. An nec dicat aliquam dolores, ei vim saepe labitur.</p>
			</div>
		</div>
		<div role="listitem" tabindex="-1" aria-label="Trevor Hartsel">
			<div role="document">
				<a href="/message"><strong>Trevor</strong> @trevor</a>
				<p>Sit no clita percipit assentior. Sea ne facer veniam contentiones. Cu zril perpetua postulant mea, iudico delicata expetendis ad eum. Sed at error verterem. Latine vocibus et vis.</p>
			</div>
		</div>

	</div>

</div>

<script type="text/javascript">
	(function() {

		var selectItem = function(node) {
			var resultsList = document.getElementById('resultslist');
			var selected = resultsList.querySelector('.selected');
			if (selected) {
				selected.classList.remove('selected');
			}

			node.classList.add('selected');
			node.focus();
		};

		var getInitialSelection = function(resultsList, keyCode) {
			if (keyCode === 38) {
				return resultsList.lastElementChild;
			}

			if (keyCode === 40) {
				return resultsList.firstElementChild;
			}
		};

		var getNextSelection = function(current, keyCode) {
			var next = current.nextElementSibling;
			var prev = current.previousElementSibling;

			if (keyCode === 38) {
				return prev ? prev : current.parentNode.lastElementChild;
			}

			if (keyCode === 40) {
				return next ? next : current.parentNode.firstElementChild;
			}
		};


		document.getElementById('resultslist').addEventListener('keydown', function(e) {
			var resultsList = e.currentTarget;
			var selected = resultsList.querySelector('.selected');
			var keyCode = e.keyCode;

			if (!(keyCode === 38 || keyCode === 40)) {
				return;
			}

			e.preventDefault();

			var next = selected ? getNextSelection(selected, keyCode) : getInitialSelection(resultsList, keyCode);
			if (next) {
				selectItem(next);
			}
		}, false);	

	})();
</script>